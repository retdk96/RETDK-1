<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>网页小游戏</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        touch-action: manipulation;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        padding: 15px;
        overflow: auto;
      }

      .game-container {
        background-color: rgba(0, 0, 0, 0.9);
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
        overflow: visible;
        width: 100%;
        max-width: 850px;
        padding: 20px;
        color: white;
        position: relative;
        margin: 20px 0;
      }

      header {
        text-align: center;
        margin-bottom: 15px;
        padding-top: 10px;
      }

      h1 {
        font-size: 2.8rem;
        color: #20d2d8;
        text-shadow: 0 0 15px rgba(0, 199, 244, 0.8);
        margin-bottom: 5px;
        letter-spacing: 1.5px;
      }

      .game-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        font-size: 1.1rem;
      }

      .score-container,
      .high-score-container {
        font-weight: bold;
        display: flex;
        align-items: center;
      }

      .score-value,
      .high-score-value {
        color: #14ba1a;
        font-size: 1.8rem;
        display: inline-block;
        min-width: 50px;
        margin-left: 8px;
        text-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
      }

      .game-area {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #gameCanvas {
        background-color: #0d0d0d;
        border-radius: 8px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.8);
        display: block;
        max-width: 100%;
      }

      .controls {
        margin-top: 20px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .btn {
        padding: 13px 28px;
        font-size: 1.15rem;
        font-weight: bold;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        background: linear-gradient(to right, #fbd84a, #ff8c00);
        color: #222;
        transition: all 0.2s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .btn::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .btn:hover::after {
        transform: translateX(0);
      }

      .btn:active {
        transform: translateY(3px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .btn:disabled {
        background: #666;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .instructions {
        margin-top: 25px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        font-size: 0.95rem;
        line-height: 1.6;
        width: 100%;
      }

      .instructions h2 {
        color: #ffde59;
        margin-bottom: 10px;
        text-align: center;
        font-size: 1.4rem;
      }

      .instructions ul {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 8px;
      }

      .game-over {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.95);
        padding: 35px 30px;
        border-radius: 15px;
        text-align: center;
        display: none;
        z-index: 100;
        box-shadow: 0 0 40px rgba(255, 0, 0, 0.6);
        border: 3px solid #ff3333;
        width: 90%;
        max-width: 500px;
      }

      .game-over h2 {
        color: #ff3333;
        font-size: 2.6rem;
        margin-bottom: 25px;
        text-shadow: 0 0 15px rgba(255, 51, 51, 0.7);
      }

      .final-score {
        font-size: 2rem;
        margin-bottom: 30px;
        color: #ffde59;
      }

      /* 手机方向控制 */
      .mobile-controls {
        display: none;
        margin-top: 25px;
        width: 100%;
        max-width: 320px;
        position: relative;
      }

      .control-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr;
        gap: 10px;
        width: 100%;
        aspect-ratio: 1/1;
      }

      .control-btn {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 32px;
        cursor: pointer;
        user-select: none;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.1s ease;
        border: 2px solid rgba(255, 222, 89, 0.3);
      }

      .control-btn:active {
        background: rgba(255, 222, 89, 0.4);
        transform: scale(0.95);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      #upBtn {
        grid-column: 2;
        grid-row: 1;
      }

      #leftBtn {
        grid-column: 1;
        grid-row: 2;
      }

      #downBtn {
        grid-column: 2;
        grid-row: 3;
      }

      #rightBtn {
        grid-column: 3;
        grid-row: 2;
      }

      /* 媒体查询 - 移动设备适配 */
      @media (max-width: 768px) {
        body {
          padding: 10px;
          align-items: flex-start;
        }

        .game-container {
          padding: 15px;
          border-radius: 12px;
          margin: 10px 0;
        }

        h1 {
          font-size: 2.3rem;
          margin-bottom: 3px;
        }

        .game-info {
          flex-direction: column;
          gap: 12px;
          align-items: center;
          padding: 10px;
          margin-bottom: 12px;
        }

        .controls {
          margin-top: 15px;
          margin-bottom: 5px;
          gap: 12px;
          width: 100%;
        }

        .btn {
          padding: 12px 20px;
          font-size: 1.1rem;
          flex: 1;
          min-width: 45%;
        }

        #gameCanvas {
          width: 100%;
          height: 50vh;
          max-height: 450px;
        }

        .mobile-controls {
          display: block;
        }

        .instructions {
          margin-top: 20px;
          padding: 12px;
          font-size: 0.9rem;
        }

        .instructions h2 {
          font-size: 1.3rem;
        }

        .instructions ul {
          padding-left: 15px;
        }
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 2rem;
        }

        .score-container,
        .high-score-container {
          font-size: 1.05rem;
        }

        .score-value,
        .high-score-value {
          font-size: 1.6rem;
        }

        .btn {
          padding: 10px 15px;
          font-size: 1rem;
          min-width: 40%;
        }

        .control-btn {
          font-size: 28px;
        }

        .game-over {
          padding: 25px 20px;
        }

        .game-over h2 {
          font-size: 2.2rem;
        }

        .final-score {
          font-size: 1.8rem;
        }

        #gameCanvas {
          height: 45vh;
        }
      }

      .performance-hint {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0, 200, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        display: none;
        z-index: 200;
      }

      .game-stats {
        display: flex;
        justify-content: space-around;
        margin-top: 15px;
        width: 100%;
        font-size: 0.9rem;
      }

      .game-stats div {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="performance-hint" id="perfHint">高性能模式</div>

    <div class="game-container">
      <header>
        <h1>Death Game</h1>
        <p>享受游戏，热爱生活，不为技术，娱乐至上！</p>
      </header>

      <div class="game-info">
        <div class="score-container">
          分数: <span id="score" class="score-value">0</span>
        </div>
        <div class="high-score-container">
          最高分: <span id="high-score" class="high-score-value">0</span>
        </div>
      </div>

      <div class="game-area">
        <canvas id="gameCanvas"></canvas>

        <div class="mobile-controls">
          <div class="control-grid">
            <div class="control-btn" id="upBtn">↑</div>
            <div class="control-btn" id="leftBtn">←</div>
            <div class="control-btn" id="downBtn">↓</div>
            <div class="control-btn" id="rightBtn">→</div>
          </div>
        </div>

        <div class="controls">
          <button id="startBtn" class="btn">开始游戏</button>
          <button id="restartBtn" class="btn">重新开始</button>
        </div>

        <div class="instructions">
          <h2>游戏说明</h2>
          <ul>
            <li>使用 <strong>方向键或虚拟按键</strong> 控制移动</li>
            <li>
              吃到<strong style="color: #ff5252">红色食物</strong>增加长度和分数
            </li>
            <li>
              撞到<strong style="color: #888">墙壁</strong>或<strong
                style="color: #4caf50"
                >自己身体</strong
              >游戏结束
            </li>
            <li>要是还看不懂就报警吧</li>
          </ul><hr>
          <div style="text-align: center;" <a href="https://imgloc.com/image/2pLMq"><img 
            src="https://i.imgs.ovh/2025/07/30/2pLMq.jpeg"
             alt="2pLMq.jpeg" border="0"
              height="370"
                width="290"></a>
                <p><strong>联系作者汇报bug ↑ </strong></p>
            <p>© 2025 每秒23兆字节. 保留所有权利</p>
        <p>作者邮箱：2309194142@qq.com · 网站作者QQ：2309194142</p></div>
        </div>

        <div class="game-stats">
          <div>长度: <span id="snake-length">3</span></div>
          <div>速度: <span id="game-speed">正常</span></div>
          <div>食物: <span id="food-count">0</span></div>
        </div>
      </div>
    </div>

    <div id="gameOver" class="game-over">
      <h2 id="gameResult">游戏结束!</h2>
      <div class="final-score">得分: <span id="finalScore">0</span></div>
      <button id="playAgainBtn" class="btn">再玩一次</button>
    </div>

    <script>
      // 获取Canvas元素和上下文
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const perfHint = document.getElementById("perfHint");

      // 设置Canvas尺寸 - 响应式设计
      function setupCanvas() {
        const maxWidth = Math.min(700, window.innerWidth * 0.95);
        const maxHeight = Math.min(500, window.innerHeight * 0.6);

        canvas.width = maxWidth;
        canvas.height = maxHeight;

        // 手机端特殊处理
        if (window.innerWidth <= 768) {
          canvas.width = window.innerWidth * 0.92;
          canvas.height = window.innerHeight * 0.45;
        }
      }

      // 游戏变量
      const gridSize = 20;
      let tileCountX, tileCountY;
      let snake = [];
      let food = {};
      let dx = gridSize;
      let dy = 0;
      let score = 0;
      let highScore = localStorage.getItem("snakeHighScore") || 0;
      let gameRunning = false;
      let lastRenderTime = 0;
      let gameLoop;
      let foodCount = 0;

      // 游戏速度控制
      const BASE_SPEED = 120; // 毫秒
      let gameSpeed = BASE_SPEED;

      // DOM元素
      const scoreElement = document.getElementById("score");
      const highScoreElement = document.getElementById("high-score");
      const finalScoreElement = document.getElementById("finalScore");
      const gameResultElement = document.getElementById("gameResult");
      const startBtn = document.getElementById("startBtn");
      const restartBtn = document.getElementById("restartBtn");
      const playAgainBtn = document.getElementById("playAgainBtn");
      const gameOverElement = document.getElementById("gameOver");
      const snakeLengthElement = document.getElementById("snake-length");
      const gameSpeedElement = document.getElementById("game-speed");
      const foodCountElement = document.getElementById("food-count");

      // 移动控制按钮
      const upBtn = document.getElementById("upBtn");
      const downBtn = document.getElementById("downBtn");
      const leftBtn = document.getElementById("leftBtn");
      const rightBtn = document.getElementById("rightBtn");

      // 初始化游戏
      function initGame() {
        setupCanvas();

        // 计算格子数量
        tileCountX = Math.floor(canvas.width / gridSize);
        tileCountY = Math.floor(canvas.height / gridSize);

        // 初始化蛇
        snake = [
          {
            x: Math.floor(tileCountX / 2) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          },
          {
            x: (Math.floor(tileCountX / 2) - 1) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          },
          {
            x: (Math.floor(tileCountX / 2) - 2) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          },
        ];

        // 生成食物
        generateFood();

        // 重置移动方向
        dx = gridSize;
        dy = 0;

        // 重置分数
        score = 0;
        foodCount = 0;
        gameSpeed = BASE_SPEED;
        updateScore();
        updateStats();

        // 更新最高分显示
        highScoreElement.textContent = highScore;

        // 隐藏游戏结束界面
        gameOverElement.style.display = "none";

        // 绘制初始状态
        drawGame();
      }

      // 生成食物
      function generateFood() {
        const maxAttempts = 1000;
        let attempts = 0;
        let foodOnSnake;

        do {
          attempts++;
          foodOnSnake = false;

          // 确保食物在有效区域内
          const foodX = Math.floor(Math.random() * (tileCountX - 4) + 2);
          const foodY = Math.floor(Math.random() * (tileCountY - 4) + 2);

          food = {
            x: foodX * gridSize,
            y: foodY * gridSize,
          };

          // 检查食物是否出现在蛇身上
          for (let segment of snake) {
            if (segment.x === food.x && segment.y === food.y) {
              foodOnSnake = true;
              break;
            }
          }

          if (attempts >= maxAttempts) {
            gameWin();
            return;
          }
        } while (foodOnSnake);
      }

      // 绘制游戏
      function drawGame() {
        // 清除画布
        ctx.fillStyle = "#0a0a0a";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 绘制墙体
        ctx.fillStyle = "#555";
        ctx.fillRect(0, 0, canvas.width, gridSize);
        ctx.fillRect(0, 0, gridSize, canvas.height);
        ctx.fillRect(canvas.width - gridSize, 0, gridSize, canvas.height);
        ctx.fillRect(0, canvas.height - gridSize, canvas.width, gridSize);

        // 绘制蛇
        snake.forEach((segment, index) => {
          if (index === 0) {
            ctx.fillStyle = "#4caf50";
            ctx.shadowColor = "#4caf50";
            ctx.shadowBlur = 10;
          } else {
            const greenValue = 150 - Math.min(15 * index, 100);
            ctx.fillStyle = `rgb(50, ${greenValue}, 50)`;
            ctx.shadowBlur = 0;
          }
          ctx.fillRect(segment.x, segment.y, gridSize - 1, gridSize - 1);

          // 蛇头眼睛
          if (index === 0) {
            ctx.fillStyle = "#000";
            ctx.shadowBlur = 0;
            if (dx > 0) {
              ctx.fillRect(segment.x + 13, segment.y + 5, 3, 3);
              ctx.fillRect(segment.x + 13, segment.y + 12, 3, 3);
            } else if (dx < 0) {
              ctx.fillRect(segment.x + 4, segment.y + 5, 3, 3);
              ctx.fillRect(segment.x + 4, segment.y + 12, 3, 3);
            } else if (dy > 0) {
              ctx.fillRect(segment.x + 5, segment.y + 13, 3, 3);
              ctx.fillRect(segment.x + 12, segment.y + 13, 3, 3);
            } else {
              ctx.fillRect(segment.x + 5, segment.y + 4, 3, 3);
              ctx.fillRect(segment.x + 12, segment.y + 4, 3, 3);
            }
          }
        });

        // 绘制食物
        ctx.fillStyle = "#ff5252";
        ctx.shadowColor = "#ff5252";
        ctx.shadowBlur = 15;
        ctx.beginPath();
        ctx.arc(
          food.x + gridSize / 2,
          food.y + gridSize / 2,
          gridSize / 2 - 2,
          0,
          Math.PI * 2
        );
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      // 移动蛇
      function moveSnake() {
        // 创建新的蛇头
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        // 检查是否撞墙
        if (
          head.x < gridSize ||
          head.x >= canvas.width - gridSize ||
          head.y < gridSize ||
          head.y >= canvas.height - gridSize
        ) {
          gameOver();
          return;
        }

        // 检查是否撞到自己
        for (let i = 0; i < snake.length; i++) {
          if (head.x === snake[i].x && head.y === snake[i].y) {
            gameOver();
            return;
          }
        }

        // 在开头添加新的蛇头
        snake.unshift(head);

        // 检查是否吃到食物
        if (head.x === food.x && head.y === food.y) {
          // 吃到食物
          score++;
          foodCount++;

          // 每吃5个食物增加速度
          if (foodCount % 5 === 0 && gameSpeed > 60) {
            gameSpeed -= 10;
          }

          updateScore();
          updateStats();

          // 生成新食物
          generateFood();
        } else {
          // 没吃到食物，移除蛇尾
          snake.pop();
        }

        drawGame();
      }

      // 更新分数显示
      function updateScore() {
        scoreElement.textContent = score;

        // 更新最高分
        if (score > highScore) {
          highScore = score;
          highScoreElement.textContent = highScore;
          localStorage.setItem("snakeHighScore", highScore);
        }
      }

      // 更新游戏统计信息
      function updateStats() {
        snakeLengthElement.textContent = snake.length;
        foodCountElement.textContent = foodCount;

        // 更新速度显示
        if (gameSpeed < 80) {
          gameSpeedElement.textContent = "快速";
          gameSpeedElement.style.color = "#ff5252";
        } else if (gameSpeed < 110) {
          gameSpeedElement.textContent = "中速";
          gameSpeedElement.style.color = "#ffde59";
        } else {
          gameSpeedElement.textContent = "正常";
          gameSpeedElement.style.color = "#4caf50";
        }
      }

      // 游戏主循环
      function gameStep() {
        if (gameRunning) {
          moveSnake();
        }
      }

      // 开始游戏
      function startGame() {
        if (!gameRunning) {
          gameRunning = true;
          gameLoop = setInterval(gameStep, gameSpeed);
          startBtn.disabled = true;
          perfHint.style.display = "block";
          setTimeout(() => {
            perfHint.style.display = "none";
          }, 2000);
        }
      }

      // 游戏结束
      function gameOver() {
        clearInterval(gameLoop);
        gameRunning = false;
        startBtn.disabled = false;

        // 显示最终得分
        gameResultElement.textContent = "乐色";
        finalScoreElement.textContent = score;
        gameOverElement.style.display = "block";
      }

      // 游戏胜利
      function gameWin() {
        clearInterval(gameLoop);
        gameRunning = false;
        startBtn.disabled = false;

        // 显示最终得分
        gameResultElement.textContent = "恭喜获胜!";
        finalScoreElement.textContent = score;
        gameOverElement.style.display = "block";
      }

      // 键盘控制
      document.addEventListener("keydown", (e) => {
        if ([37, 38, 39, 40].includes(e.keyCode)) {
          e.preventDefault();
        }

        switch (e.keyCode) {
          case 37: // 左箭头
            if (dx === 0) {
              dx = -gridSize;
              dy = 0;
            }
            break;
          case 38: // 上箭头
            if (dy === 0) {
              dx = 0;
              dy = -gridSize;
            }
            break;
          case 39: // 右箭头
            if (dx === 0) {
              dx = gridSize;
              dy = 0;
            }
            break;
          case 40: // 下箭头
            if (dy === 0) {
              dx = 0;
              dy = gridSize;
            }
            break;
        }
      });

      // 触摸控制
      function addDirectionListener(element, dirX, dirY) {
        element.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            if (dx === 0 && dy === 0) return;

            if (dx === 0 && dy !== -dirY) {
              dx = dirX;
              dy = dirY;
            } else if (dy === 0 && dx !== -dirX) {
              dx = dirX;
              dy = dirY;
            }
          },
          { passive: false }
        );

        element.addEventListener("mousedown", () => {
          if (dx === 0 && dy === 0) return;

          if (dx === 0 && dy !== -dirY) {
            dx = dirX;
            dy = dirY;
          } else if (dy === 0 && dx !== -dirX) {
            dx = dirX;
            dy = dirY;
          }
        });
      }

      addDirectionListener(upBtn, 0, -gridSize);
      addDirectionListener(downBtn, 0, gridSize);
      addDirectionListener(leftBtn, -gridSize, 0);
      addDirectionListener(rightBtn, gridSize, 0);

      // 按钮事件监听
      startBtn.addEventListener("click", startGame);
      restartBtn.addEventListener("click", () => {
        clearInterval(gameLoop);
        initGame();
        gameRunning = false;
        startBtn.disabled = false;
      });
      playAgainBtn.addEventListener("click", () => {
        clearInterval(gameLoop);
        initGame();
      });

      // 窗口大小变化时重新初始化
      window.addEventListener("resize", () => {
        if (!gameRunning) {
          initGame();
        }
      });

      // 初始化游戏
      initGame();
    </script>
  </body>
</html>

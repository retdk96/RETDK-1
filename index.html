<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>网页小游戏</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        touch-action: manipulation;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        padding: 20px;
      }

      .game-container {
        background-color: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        width: 100%;
        max-width: 800px;
        padding: 20px;
        color: white;
      }

      header {
        text-align: center;
        margin-bottom: 20px;
      }

      h1 {
        font-size: 2.8rem;
        color: #0ee7ff;
        text-shadow: 0 0 10px rgba(45, 208, 253, 0.7);
        margin-bottom: 10px;
        letter-spacing: 2px;
      }

      .game-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      .score-container,
      .high-score-container {
        font-size: 1.4rem;
        font-weight: bold;
      }

      .score-value,
      .high-score-value {
        color: #23b551;
        font-size: 1.8rem;
        display: inline-block;
        min-width: 50px;
      }

      .game-area {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #gameCanvas {
        background-color: #111;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        display: block;
        max-width: 100%;
      }

      .controls {
        margin-top: 20px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .btn {
        padding: 12px 25px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        background: linear-gradient(to right, #ffde59, #ff8c00);
        color: #222;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
      }

      .btn:active {
        transform: translateY(1px);
      }

      .btn:disabled {
        background: #777;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .instructions {
        margin-top: 25px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        font-size: 1rem;
        line-height: 1.6;
        width: 100%;
      }

      .instructions h2 {
        color: #ffde59;
        margin-bottom: 10px;
        text-align: center;
      }

      .instructions ul {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 8px;
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        display: none;
        z-index: 10;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        border: 2px solid #c80808;
        width: 90%;
        max-width: 500px;
      }

      .game-over h2 {
        color: #ff3333;
        font-size: 2.5rem;
        margin-bottom: 20px;
      }

      .final-score {
        font-size: 1.8rem;
        margin-bottom: 25px;
      }

      /* 手机方向控制 */
      .mobile-controls {
        display: none;
        margin-top: 20px;
        width: 100%;
        max-width: 300px;
      }

      .control-row {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
      }

      .control-btn {
        width: 70px;
        height: 70px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        margin: 0 10px;
        cursor: pointer;
        user-select: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: all 0.2s;
      }

      .control-btn:active {
        background: rgba(255, 222, 89, 0.5);
        transform: scale(0.95);
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .game-info {
          flex-direction: column;
          gap: 10px;
          align-items: center;
        }

        .controls {
          flex-direction: column;
          width: 100%;
        }

        .btn {
          width: 100%;
          margin-bottom: 10px;
        }

        #gameCanvas {
          width: 95vw;
          height: 65vh;
          max-width: 790px;
        }

        .mobile-controls {
          display: block;
        }
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.8rem;
        }

        .score-container,
        .high-score-container {
          font-size: 1.2rem;
        }

        .score-value,
        .high-score-value {
          font-size: 1.4rem;
        }

        .control-btn {
          width: 60px;
          height: 60px;
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <header>
        <h1>Death Game</h1>
        <p>享受游戏，热爱生活，不为技术，娱乐至上！</p>
      </header>

      <div class="game-info">
        <div class="score-container">
          当前分数: <span id="score" class="score-value">0</span>
        </div>
        <div class="high-score-container">
          最高分: <span id="high-score" class="high-score-value">0</span>
        </div>
      </div>

      <div class="game-area">
        <canvas id="gameCanvas"></canvas>

        <!-- 手机方向控制 -->
        <div class="mobile-controls">
          <div class="control-row">
            <div class="control-btn" id="upBtn">↑</div>
          </div>
          <div class="control-row">
            <div class="control-btn" id="leftBtn">←</div>
            <div class="control-btn" id="downBtn">↓</div>
            <div class="control-btn" id="rightBtn">→</div>
          </div>
        </div>

        <div class="controls">
          <button id="startBtn" class="btn">开始游戏</button>
          <button id="pauseBtn" class="btn" disabled>暂停</button>
          <button id="restartBtn" class="btn">重新开始</button>
        </div>

        <div class="instructions">
          <h2>游戏说明</h2>
          <ul>
            <li>使用 <strong>↑ ← ↓ →</strong> 方向键控制移动</li>
            <li>吃到食物（红色方块）后，蛇身会变长，分数+1</li>
            <li>撞到墙壁或自己的身体，游戏结束</li>
            <li>尽可能吃到更多的食物，挑战最高分！</li>
            <li>要是还看不懂就报警吧</li>
            </ul>
          </ul>
          <hr>
          <div style="text-align: center;" <a href="https://imgloc.com/image/2pLMq"><img 
            src="https://i.imgs.ovh/2025/07/30/2pLMq.jpeg"
             alt="2pLMq.jpeg" border="0"
              height="250"
                width="210"></a>
                <p><strong>联系作者汇报bug ↑ </strong></p>
            <p>© 2025 每秒23兆字节. 保留所有权利</p>
        <p>作者邮箱：2309194142@qq.com · 网站作者QQ：2309194142</p></div>
        </div>
      </div>
    </div>

    <div id="gameOver" class="game-over">
      <h2 id="gameResult"></h2>
      <div class="final-score">最终得分: <span id="finalScore">0</span></div>
      <button id="playAgainBtn" class="btn">再玩一次</button>
    </div>

    <script>
      // 获取Canvas元素和上下文
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // 设置Canvas尺寸 - 响应式设计
      function setupCanvas() {
        const maxWidth = Math.min(600, window.innerWidth * 0.9);
        const maxHeight = Math.min(400, window.innerHeight * 0.6);

        canvas.width = maxWidth;
        canvas.height = maxHeight;
      }

      // 游戏变量
      const gridSize = 20; // 网格大小
      let tileCountX, tileCountY;
      let snake = [];
      let food = {};
      let dx = gridSize; // 蛇的初始水平移动速度
      let dy = 0; // 蛇的初始垂直移动速度
      let score = 0;
      let highScore = localStorage.getItem("snakeHighScore") || 0;
      let gameRunning = false;
      let gameLoop;

      // DOM元素
      const scoreElement = document.getElementById("score");
      const highScoreElement = document.getElementById("high-score");
      const finalScoreElement = document.getElementById("finalScore");
      const gameResultElement = document.getElementById("gameResult");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const restartBtn = document.getElementById("restartBtn");
      const playAgainBtn = document.getElementById("playAgainBtn");
      const gameOverElement = document.getElementById("gameOver");

      // 移动控制按钮
      const upBtn = document.getElementById("upBtn");
      const downBtn = document.getElementById("downBtn");
      const leftBtn = document.getElementById("leftBtn");
      const rightBtn = document.getElementById("rightBtn");

      // 初始化游戏
      function initGame() {
        setupCanvas();

        // 计算格子数量
        tileCountX = Math.floor(canvas.width / gridSize);
        tileCountY = Math.floor(canvas.height / gridSize);

        // 初始化蛇
        snake = [
          {
            x: Math.floor(tileCountX / 2) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          }, // 蛇头
          {
            x: (Math.floor(tileCountX / 2) - 1) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          }, // 蛇身
          {
            x: (Math.floor(tileCountX / 2) - 2) * gridSize,
            y: Math.floor(tileCountY / 2) * gridSize,
          }, // 蛇身
        ];

        // 生成食物
        generateFood();

        // 重置移动方向
        dx = gridSize;
        dy = 0;

        // 重置分数
        score = 0;
        updateScore();

        // 更新最高分显示
        highScoreElement.textContent = highScore;

        // 隐藏游戏结束界面
        gameOverElement.style.display = "none";
      }

      // 生成食物 - 修复版本
      function generateFood() {
        const maxAttempts = 1000; // 最大尝试次数，防止死循环
        let attempts = 0;
        let foodOnSnake;

        do {
          attempts++;
          foodOnSnake = false;

          // 确保食物在有效区域内 (1到tileCount-2之间)
          const foodX = Math.floor(Math.random() * (tileCountX - 4) + 2);
          const foodY = Math.floor(Math.random() * (tileCountY - 4) + 2);

          food = {
            x: foodX * gridSize,
            y: foodY * gridSize,
          };

          // 检查食物是否出现在蛇身上
          for (let segment of snake) {
            if (segment.x === food.x && segment.y === food.y) {
              foodOnSnake = true;
              break;
            }
          }

          // 检查是否达到最大尝试次数
          if (attempts >= maxAttempts) {
            // 如果无法找到位置，判断为游戏胜利
            gameWin();
            return;
          }
        } while (foodOnSnake);
      }

      // 绘制游戏
      function drawGame() {
        // 清除画布
        ctx.fillStyle = "#111";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 绘制墙体
        ctx.fillStyle = "#444";
        ctx.fillRect(0, 0, canvas.width, gridSize); // 上墙
        ctx.fillRect(0, 0, gridSize, canvas.height); // 左墙
        ctx.fillRect(canvas.width - gridSize, 0, gridSize, canvas.height); // 右墙
        ctx.fillRect(0, canvas.height - gridSize, canvas.width, gridSize); // 下墙

        // 绘制蛇
        snake.forEach((segment, index) => {
          if (index === 0) {
            // 蛇头
            ctx.fillStyle = "#4caf50";
          } else {
            // 蛇身
            const greenValue = 150 - Math.min(15 * index, 100);
            ctx.fillStyle = `rgb(50, ${greenValue}, 50)`;
          }
          ctx.fillRect(segment.x, segment.y, gridSize - 1, gridSize - 1);

          // 蛇头眼睛
          if (index === 0) {
            ctx.fillStyle = "#000";
            // 根据方向绘制眼睛位置
            if (dx > 0) {
              // 向右
              ctx.fillRect(segment.x + 13, segment.y + 5, 3, 3);
              ctx.fillRect(segment.x + 13, segment.y + 12, 3, 3);
            } else if (dx < 0) {
              // 向左
              ctx.fillRect(segment.x + 4, segment.y + 5, 3, 3);
              ctx.fillRect(segment.x + 4, segment.y + 12, 3, 3);
            } else if (dy > 0) {
              // 向下
              ctx.fillRect(segment.x + 5, segment.y + 13, 3, 3);
              ctx.fillRect(segment.x + 12, segment.y + 13, 3, 3);
            } else {
              // 向上
              ctx.fillRect(segment.x + 5, segment.y + 4, 3, 3);
              ctx.fillRect(segment.x + 12, segment.y + 4, 3, 3);
            }
          }
        });

        // 绘制食物
        ctx.fillStyle = "#ff5252";
        ctx.beginPath();
        ctx.arc(
          food.x + gridSize / 2,
          food.y + gridSize / 2,
          gridSize / 2 - 2,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }

      // 移动蛇
      function moveSnake() {
        // 创建新的蛇头
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        // 检查是否撞墙
        if (
          head.x < gridSize ||
          head.x >= canvas.width - gridSize ||
          head.y < gridSize ||
          head.y >= canvas.height - gridSize
        ) {
          gameOver();
          return;
        }

        // 检查是否撞到自己
        for (let i = 0; i < snake.length; i++) {
          if (head.x === snake[i].x && head.y === snake[i].y) {
            gameOver();
            return;
          }
        }

        // 在开头添加新的蛇头
        snake.unshift(head);

        // 检查是否吃到食物
        if (head.x === food.x && head.y === food.y) {
          // 吃到食物，增加分数
          score++;
          updateScore();

          // 生成新食物
          generateFood();
        } else {
          // 没吃到食物，移除蛇尾
          snake.pop();
        }
      }

      // 更新分数显示
      function updateScore() {
        scoreElement.textContent = score;

        // 更新最高分
        if (score > highScore) {
          highScore = score;
          highScoreElement.textContent = highScore;
          localStorage.setItem("snakeHighScore", highScore);
        }
      }

      // 游戏主循环
      function gameStep() {
        moveSnake();
        drawGame();
      }

      // 开始游戏
      function startGame() {
        if (!gameRunning) {
          gameRunning = true;
          gameLoop = setInterval(gameStep, 150);
          startBtn.disabled = true;
          pauseBtn.disabled = false;
        }
      }

      // 暂停游戏
      function pauseGame() {
        if (gameRunning) {
          clearInterval(gameLoop);
          gameRunning = false;
          pauseBtn.textContent = "继续";
        } else {
          gameRunning = true;
          gameLoop = setInterval(gameStep, 150);
          pauseBtn.textContent = "暂停";
        }
      }

      // 游戏结束
      function gameOver() {
        clearInterval(gameLoop);
        gameRunning = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        pauseBtn.textContent = "暂停";

        // 显示最终得分
        gameResultElement.textContent = "撞墙了?正常,毕竟您这操作精度堪比帕金森晚期,友情提示:建议用脚玩反正手和脚没区别";
        finalScoreElement.textContent = score;
        gameOverElement.style.display = "block";
      }

      // 游戏胜利
      function gameWin() {
        clearInterval(gameLoop);
        gameRunning = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        pauseBtn.textContent = "暂停";

        // 显示最终得分
        gameResultElement.textContent = "恭喜获胜!";
        finalScoreElement.textContent = score;
        gameOverElement.style.display = "block";
      }

      // 键盘控制
      document.addEventListener("keydown", (e) => {
        // 防止方向键滚动页面
        if ([37, 38, 39, 40].includes(e.keyCode)) {
          e.preventDefault();
        }

        // 方向键控制
        switch (e.keyCode) {
          case 37: // 左箭头
            if (dx === 0) {
              // 防止180度转弯
              dx = -gridSize;
              dy = 0;
            }
            break;
          case 38: // 上箭头
            if (dy === 0) {
              dx = 0;
              dy = -gridSize;
            }
            break;
          case 39: // 右箭头
            if (dx === 0) {
              dx = gridSize;
              dy = 0;
            }
            break;
          case 40: // 下箭头
            if (dy === 0) {
              dx = 0;
              dy = gridSize;
            }
            break;
          case 32: // 空格键
            if (gameRunning) {
              pauseGame();
            } else {
              startGame();
            }
            break;
        }
      });

      // 触摸控制
      upBtn.addEventListener("click", () => {
        if (dy === 0) {
          dx = 0;
          dy = -gridSize;
        }
      });

      downBtn.addEventListener("click", () => {
        if (dy === 0) {
          dx = 0;
          dy = gridSize;
        }
      });

      leftBtn.addEventListener("click", () => {
        if (dx === 0) {
          dx = -gridSize;
          dy = 0;
        }
      });

      rightBtn.addEventListener("click", () => {
        if (dx === 0) {
          dx = gridSize;
          dy = 0;
        }
      });

      // 按钮事件监听
      startBtn.addEventListener("click", startGame);
      pauseBtn.addEventListener("click", pauseGame);
      restartBtn.addEventListener("click", () => {
        clearInterval(gameLoop);
        initGame();
        gameRunning = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        pauseBtn.textContent = "暂停";
        drawGame();
      });
      playAgainBtn.addEventListener("click", () => {
        initGame();
        drawGame();
      });

      // 窗口大小变化时重新初始化
      window.addEventListener("resize", initGame);

      // 初始化游戏
      initGame();
      drawGame();
    </script>
  </body>
</html>
